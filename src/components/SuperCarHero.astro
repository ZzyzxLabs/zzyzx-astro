---
/**
 * SuperCarHero â€” Full-screen looping video background hero.
 * All 3 clips are preloaded as separate <video> elements to avoid
 * black-screen flicker on transitions in production.
 */
const videos = ["/SuperCar/1.mp4", "/SuperCar/2.mp4", "/SuperCar/3.mp4"];
---

<div id="supercar-hero" class="fixed inset-0 -z-10 overflow-hidden">
    <!-- All 3 videos preloaded; only one visible at a time -->
    {
        videos.map((src, i) => (
            <video
                data-sc-index={i}
                autoplay={i === 0}
                muted
                playsinline
                preload="auto"
                class:list={[
                    "supercar-vid absolute inset-0 w-full h-full object-cover transition-opacity duration-700",
                    i === 0 ? "opacity-100 z-[1]" : "opacity-0 z-0",
                ]}
                src={src}
            />
        ))
    }

    <!-- Overlay gradient for readability -->
    <div
        class="absolute inset-0 bg-gradient-to-b from-black/50 via-black/30 to-black/70 z-[2]"
    >
    </div>

    <!-- Bottom fade into the page -->
    <div
        class="absolute bottom-0 left-0 w-full h-48 bg-gradient-to-t from-bg-base to-transparent z-[2]"
    >
    </div>
</div>

<script>
    const vids = Array.from(
        document.querySelectorAll<HTMLVideoElement>(".supercar-vid"),
    );
    let current = 0;

    if (vids.length > 0) {
        // Start playing the first video
        vids[0].play().catch(() => {});

        // When current video ends, crossfade to next
        vids.forEach((vid, i) => {
            vid.addEventListener("ended", () => {
                if (i !== current) return; // only handle the active video

                const next = (current + 1) % vids.length;

                // Fade out current, fade in next
                vids[current].classList.remove("opacity-100", "z-[1]");
                vids[current].classList.add("opacity-0", "z-0");

                vids[next].classList.remove("opacity-0", "z-0");
                vids[next].classList.add("opacity-100", "z-[1]");
                vids[next].currentTime = 0;
                vids[next].play().catch(() => {});

                current = next;
            });
        });
    }
</script>
